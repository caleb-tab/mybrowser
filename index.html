<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codespaces Tabbed Browser</title>
    <!-- Tailwind CSS CDN for easy styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the scrollbar within the tab content */
        .tab-content-container::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .tab-content-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .tab-content-container::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }

        .tab-content-container::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Ensure iframes fill their container */
        .tab-frame {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Hide inactive tab content */
        .tab-content:not(.active) {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col h-screen font-sans antialiased text-gray-800">
    <div class="flex-grow flex flex-col rounded-lg shadow-xl m-4 bg-white overflow-hidden">
        <!-- Browser Header and Tab Bar -->
        <div class="flex-shrink-0 bg-gray-800 p-2 flex items-center justify-between rounded-t-lg">
            <!-- Tabs container -->
            <div id="tab-buttons-container" class="flex flex-wrap gap-1 overflow-x-auto pb-1 max-w-[calc(100%-100px)]">
                <!-- Tab buttons will be injected here by JavaScript -->
            </div>

            <!-- New Tab Button -->
            <button id="new-tab-button" class="ml-2 px-3 py-1 bg-green-500 hover:bg-green-600 text-white rounded-md text-sm font-semibold transition-colors duration-200 shadow">
                + New Tab
            </button>
        </div>

        <!-- Tab Content Area -->
        <div id="tab-content-area" class="flex-grow overflow-hidden relative">
            <!-- Tab content (iframes) will be injected here by JavaScript -->
            <div class="absolute inset-0 flex items-center justify-center text-gray-500 text-lg">
                <p>Welcome! Click '+ New Tab' to get started.</p>
            </div>
        </div>
    </div>

    <script>
        const tabButtonsContainer = document.getElementById('tab-buttons-container');
        const tabContentArea = document.getElementById('tab-content-area');
        const newTabButton = document.getElementById('new-tab-button');

        let tabIdCounter = 0;
        let tabs = []; // Stores { id: 'tabX', url: 'about:blank' }
        let activeTabId = null;

        /**
         * Checks if a string looks like a valid URL.
         * A very basic heuristic.
         * @param {string} str The string to check.
         * @returns {boolean} True if it looks like a URL, false otherwise.
         */
        function looksLikeUrl(str) {
            // Check for common protocols or presence of a dot for domain names
            return str.startsWith('http://') ||
                   str.startsWith('https://') ||
                   str.startsWith('ftp://') ||
                   str.startsWith('about:') ||
                   str.includes('.'); // Simple check for a domain
        }

        /**
         * Adds a new tab to the browser.
         * @param {string} [initialUrl='https://duckduckgo.com/'] - The URL to load in the new tab.
         */
        function addTab(initialUrl = 'https://duckduckgo.com/') {
            tabIdCounter++;
            const newTabId = `tab-${tabIdCounter}`;

            // Create tab button
            const tabButton = document.createElement('button');
            tabButton.id = `btn-${newTabId}`;
            tabButton.className = 'flex items-center bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded-md text-sm focus:outline-none transition-colors duration-200 shadow-sm whitespace-nowrap';
            tabButton.innerHTML = `
                <span class="tab-title">New Tab</span>
                <button class="ml-2 text-red-300 hover:text-red-500 text-xs rounded-full p-0.5 focus:outline-none close-tab-btn" data-tab-id="${newTabId}">&times;</button>
            `;
            tabButton.addEventListener('click', (event) => {
                // Prevent activating the tab when clicking the close button
                if (!event.target.classList.contains('close-tab-btn')) {
                    activateTab(newTabId);
                }
            });
            tabButtonsContainer.appendChild(tabButton);

            // Create tab content container (for URL bar and iframe)
            const tabContentDiv = document.createElement('div');
            tabContentDiv.id = newTabId;
            tabContentDiv.className = 'tab-content absolute inset-0 flex flex-col overflow-hidden bg-white rounded-b-lg';
            tabContentDiv.innerHTML = `
                <div class="flex-shrink-0 p-2 bg-gray-200 border-b border-gray-300 flex items-center space-x-2">
                    <input type="text" class="url-input flex-grow p-2 border border-gray-400 rounded-md text-sm bg-white focus:ring-blue-500 focus:border-blue-500" placeholder="Enter URL or search on DuckDuckGo">
                    <button class="go-button px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md text-sm font-semibold transition-colors duration-200 shadow">Go</button>
                </div>
                <div class="flex-grow tab-content-container relative overflow-auto">
                    <iframe src="${initialUrl}" class="tab-frame" title="Browser Tab ${newTabId}"></iframe>
                    <div class="iframe-overlay absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center text-white text-center p-4 text-sm hidden">
                        <p>Loading... Please wait. <br> If the page remains blank, it might be due to security policies (X-Frame-Options, CSP) preventing embedding this website in an iframe.</p>
                    </div>
                </div>
            `;
            tabContentArea.appendChild(tabContentDiv);

            // Add event listeners for URL input and Go button
            const urlInput = tabContentDiv.querySelector('.url-input');
            const goButton = tabContentDiv.querySelector('.go-button');
            const iframe = tabContentDiv.querySelector('.tab-frame');
            const overlay = tabContentDiv.querySelector('.iframe-overlay');

            // Set the initial URL in the input field
            urlInput.value = initialUrl;

            // Show overlay on load start
            iframe.onload = () => {
                overlay.classList.add('hidden');
                // Attempt to update tab title from iframe content if possible (cross-origin might prevent this)
                try {
                    const docTitle = iframe.contentDocument.title;
                    if (docTitle && docTitle !== 'about:blank') {
                        tabButton.querySelector('.tab-title').textContent = docTitle;
                    } else {
                         // Fallback to hostname if title not accessible or generic
                        const url = urlInput.value;
                        try {
                            tabButton.querySelector('.tab-title').textContent = new URL(url).hostname || 'New Tab';
                        } catch (e) {
                             tabButton.querySelector('.tab-title').textContent = 'New Tab';
                        }
                    }
                } catch (e) {
                    // Fallback to URL if cross-origin policy prevents title access
                    const url = urlInput.value;
                    try {
                        tabButton.querySelector('.tab-title').textContent = new URL(url).hostname || 'New Tab';
                    } catch (e) {
                         tabButton.querySelector('.tab-title').textContent = 'New Tab';
                    }
                }
            };

            iframe.onerror = () => {
                overlay.classList.remove('hidden');
                overlay.innerHTML = `<p>Error loading page. This site likely prevents embedding.<br>URL: ${urlInput.value}</p>`;
                tabButton.querySelector('.tab-title').textContent = 'Error';
            };


            const loadPage = () => {
                let url = urlInput.value.trim();
                if (!url) {
                    url = 'about:blank'; // Default to blank if empty
                }

                if (!looksLikeUrl(url)) {
                    // If it doesn't look like a URL, treat it as a search query for DuckDuckGo
                    url = `https://duckduckgo.com/?q=${encodeURIComponent(url)}`;
                } else if (!url.startsWith('http://') && !url.startsWith('https://') && !url.startsWith('about:')) {
                    // If it looks like a URL but no protocol, default to http
                    url = 'http://' + url;
                }

                urlInput.value = url; // Update input with full URL
                iframe.src = url;
                overlay.classList.remove('hidden'); // Show loading overlay
                overlay.innerHTML = `<p>Loading... Please wait. <br> If the page remains blank, it might be due to security policies (X-Frame-Options, CSP) preventing embedding this website in an iframe.</p>`;
            };

            urlInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault(); // Prevent new line in input
                    loadPage();
                }
            });
            goButton.addEventListener('click', loadPage);

            // Store tab information
            tabs.push({ id: newTabId, url: initialUrl, button: tabButton, content: tabContentDiv, iframe: iframe, urlInput: urlInput });

            // Activate the newly created tab
            activateTab(newTabId);

            // Add event listener for close button
            tabButton.querySelector('.close-tab-btn').addEventListener('click', (event) => {
                event.stopPropagation(); // Prevent activating tab when closing
                closeTab(newTabId);
            });
        }

        /**
         * Activates a specific tab.
         * @param {string} id - The ID of the tab to activate.
         */
        function activateTab(id) {
            // Hide all tab content and deactivate all buttons
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('#tab-buttons-container button').forEach(button => {
                button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                button.classList.add('bg-gray-700', 'hover:bg-gray-600');
            });

            // Show the selected tab content and activate its button
            const activeContent = document.getElementById(id);
            const activeButton = document.getElementById(`btn-${id}`);
            if (activeContent && activeButton) {
                activeContent.classList.add('active');
                activeButton.classList.remove('bg-gray-700', 'hover:bg-gray-600');
                activeButton.classList.add('bg-blue-600', 'hover:bg-blue-700');
                activeTabId = id;
            }
        }

        /**
         * Closes a specific tab.
         * @param {string} id - The ID of the tab to close.
         */
        function closeTab(id) {
            const tabIndex = tabs.findIndex(tab => tab.id === id);
            if (tabIndex === -1) return; // Tab not found

            // Remove elements from DOM
            tabs[tabIndex].button.remove();
            tabs[tabIndex].content.remove();

            // Remove from array
            tabs.splice(tabIndex, 1);

            if (tabs.length === 0) {
                // If no tabs left, open a new one
                addTab();
            } else if (activeTabId === id) {
                // If the closed tab was active, activate another one
                const newActiveIndex = Math.min(tabIndex, tabs.length - 1); // Activate previous or last remaining
                activateTab(tabs[newActiveIndex].id);
            }
            // If the closed tab was not active, no need to change activeTabId
        }

        // Event listener for the "New Tab" button
        newTabButton.addEventListener('click', () => addTab());

        // Initial tab creation on load
        document.addEventListener('DOMContentLoaded', () => {
            addTab('https://duckduckgo.com/'); // Start with DuckDuckGo as default
        });

    </script>
</body>
</html>
